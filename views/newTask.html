<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <!--<link href="../resources/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet">-->
  </head>

  <body>
  <!--<a class="btn btn-outline-primary" href="#">Sign up</a>-->
    <div class="container">
      <div class="card-deck mb-3 mt-3 text-center">

        <div class="card mb-4 box-shadow" style="min-height: 500px;">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal" align="left">项目设置</h4>
          </div>
          <div class="card-body">
            <form class="needs-validation" id="projectForm" novalidate>
              <div class="input-group m-1">
                <div class="input-group-prepend">
                  <span class="input-group-text">项目名称：</span>
                </div>
                <input type="text" class="form-control" id="projectName" name="interfaceName" >
              </div>
              <div class="input-group m-1">
                <div class="input-group-prepend">
                  <span class="input-group-text">团队设置：</span>
                </div>
                <select class="selectpicker w-50" id="teamId" name="teamId">
                </select>
              </div>
              <div class="input-group m-1">
                <div class="input-group-prepend">
                  <span class="input-group-text">文件设置：</span>
                </div>
                <a class="btn btn-outline-primary mr-2" href="#" onclick="openFileDialog()">本地上传</a>
                <input type="hidden" class="form-control" id="fileName" name="fileName">
                <a class="btn btn-outline-primary" href="#" onclick="openFileDialog()">远程文件</a>
              </div>

              <div class="input-group m-1">
                <div class="input-group-prepend">
                  <span class="input-group-text">文件过滤  ：</span>
                </div>
                <textarea type="text" style="min-height: 60px" class="form-control" id="fileFilter" name="fileFilter"></textarea>
              </div>
              <div class="input-group m-1">
                <div class="input-group-prepend">
                  <span class="input-group-text">文件夹过滤：</span>
                </div>
                <textarea type="text" style="min-height: 60px" class="form-control" id="directoryFilter" name="directoryFilter"></textarea>
              </div>
            </form>
          </div>
        </div>
        <div class="card mb-4 box-shadow">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal" align="left">基础设置</h4>
          </div>
          <div class="card-body">

          </div>
        </div>
        <div class="card mb-4 box-shadow">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal" align="left">计划配置</h4>
          </div>
          <div class="card-body">

          </div>
        </div>

      </div>
    </div>
  </body>

  <script src="../js/jquery.form.js" type="text/javascript"></script>
  <script type="text/javascript">
      $(function () {
          var url = TASK_ADD_PREFIX + "teamSetting";
          var teamSelectParam = new DataTemplate();
          var data = sendPost(url, teamSelectParam);
          var teamArray = data.datas;
          var html = "";
          for(var i in teamArray) {
              html += '<option value=\"' + teamArray[i].teamId + '\">' + teamArray[i].teamName + '</option>'
          }

          $("#teamId").html(html);

      });

      function openFileDialog () {
          var accessToken = getAccessToken();
          var action = TASK_ADD_PREFIX + 'uploadfile';
          layer.open({
              title : "请选择文件",
              type: 1,
              skin: 'layui-layer-demo', //样式类名
              closeBtn: 1, //不显示关闭按钮
              btn : ['确认上传', '取消'],
              yes: function(index){
                  var form = $("#fileForm");
                  var file=$("#uploadFile").val();
                  if(file === ""){
                      layer.alert("请选择文件!");
                      return false;
                  }
                  form.ajaxSubmit(function (data) {
                      var response= JSON.parse(data);
                      if (response.code === "0") {
                          layer.msg("上传成功！服务器存储文件名=" + response.data.fileName, {time:2000});
                          $('#fileName').val(response.data.fileName);
                          layer.close(index);
                      } else {
                          layer.msg("上传失败！原因" + response.msg);
                      }
                  });
              },
              anim: 2,
              shadeClose: true, //开启遮罩关闭
              content: '<form id="fileForm" method="post" enctype="multipart/form-data" action="'+ action +'">' +
              '<input type="file" class="form-control" name="uploadFile" id="uploadFile" accept=".zip">' +
              '<input type="hidden" name="accesstoken" value="'+ accessToken +'">' +
              '</form>'
          });
      }
  </script>
</html>
